<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fran</title>
</head>

<body>
    <h2>Fraaaaannn!!!!</h2>
    <input type="text" id="addUserInput" placeholder="Nombre de usuario">
    <br>
    <button id="addUserBtn" type="button">Agragar usuario</button>



    <!-- <button id="myBtn" type="button">Obtener todos los usuarios</button> -->
    <table id='myTable' style="border: 1px solid;">
        <tr>
            <th>Nombres</th>
            <th>Accion</th>
        </tr>
    </table>
</body>
<script>
    async function getUsers() {
        const response = await fetch('http://localhost:3000/users')
        const data = await response.json()
        return data
    }
    async function deleteUser(personId) {
        const response2 = await fetch('http://localhost:3000/user', {
            method: 'DELETE', // or 'PUT'
            body: JSON.stringify(personId), // data can be `string` or {object}!
            headers: {
                'Content-Type': 'application/json'
            }
        })
        const data = await response2.json()
        return data
    }
    async function createUser(data) {
        console.log("ðŸš€ ~ file: index.html ~ line 45 ~ createUser ~ data", data)
        const response2 = await fetch('http://localhost:3000/user', {
            method: 'POST', // or 'PUT'
            body: JSON.stringify(data), // data can be `string` or {object}!
            headers: {
                'Content-Type': 'application/json'
            }
        })
        const resp = await response2.json()
        return resp
    }
    async function funcDel(personId) {
        console.log("personId", personId)
        const resp = await deleteUser({ id: personId })
        console.log("Respuesta de la eliminacion: ==== ", resp)
        refreshTable()
    }
    const inputChange = document.getElementById("addUserInput");
    inputChange.addEventListener('keypress', async function (fran) {
        //    console.log(this)
        //    console.log("window.event", window.event.key)
        if (window.event.key == 'Enter') {
            if (addUserInput.value != '') {
                await createUser({ name: addUserInput.value })
                addUserInput.value = ''
            }
            refreshTable()
        }
        //   console.log(fran.target.value)
    });
    // const boton = document.getElementById("myBtn");
    // boton.addEventListener("click", async function () {
    //     refreshTable()

    // });
    const addUserButton = document.getElementById("addUserBtn");
    const addUserInput = document.getElementById("addUserInput");
    addUserButton.addEventListener("click", async function () {
        if (addUserInput.value != '') {
            await createUser({ name: addUserInput.value })
        }
        refreshTable()
    });
    refreshTable()
    async function refreshTable() {
        let table = document.getElementById("myTable");
        table.innerHTML = "";
        let row = table.insertRow();
        let cell1 = row.insertCell(0);
        let cell2 = row.insertCell(1);
        cell1.innerHTML = 'Nombres';
        cell2.innerHTML = 'Accion';
        const respuesta = await getUsers()
        respuesta.forEach(persona => {
            let table = document.getElementById("myTable");
            let row = table.insertRow();
            let cell1 = row.insertCell(0);
            let cell2 = row.insertCell(1);
            cell1.innerHTML = persona.name;
            cell2.innerHTML = '<button onclick="funcDel(' + (persona.id) + ')"  type="button">X</button>'
        })
        // boton.click()
    }

</script>

</html>
